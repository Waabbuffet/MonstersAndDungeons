package com.waabbuffet.MonstersAndDungeons.tileentity.miscellaneous;

import net.minecraft.entity.Entity;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.tileentity.TileEntity;
import net.minecraft.util.ITickable;

import com.waabbuffet.MonstersAndDungeons.entity.MaDEntityMonsterBase;
import com.waabbuffet.MonstersAndDungeons.entity.automatons.EntityAutomatonsRook;
import com.waabbuffet.MonstersAndDungeons.entity.automatons.EntityWitePawns;

public class TileEntityMonsterStatue extends TileEntity implements ITickable { 

	
	NBTTagCompound storedDATA;
	int checkPlayerCD;
	
	public TileEntityMonsterStatue(MaDEntityMonsterBase entity) {
		// TODO Auto-generated constructor stub
		storedDATA = entity.getNBTData();
		
		
	}
	
	
	
	@Override
	public NBTTagCompound writeToNBT(NBTTagCompound compound) {

		compound.setTag("storedDATA", storedDATA);
		
		return super.writeToNBT(compound);
	}
	
	
	@Override
	public void readFromNBT(NBTTagCompound compound) {
		
		storedDATA = (NBTTagCompound) compound.getTag("storedDATA");
		
		super.readFromNBT(compound);
	}

	@Override
	public void update() {
		// TODO Auto-generated method stub
		
		if(this.checkPlayerCD == 0)
		{
			System.out.println(this.worldObj.getNearestAttackablePlayer(this.getPos().getX(), this.pos.getY(), this.getPos().getY(), 30, 20, null, null));
			this.checkPlayerCD = 20;
				if(this.worldObj.getNearestAttackablePlayer(this.getPos().getX(), this.pos.getY(), this.getPos().getY(), 30, 20, null, null) != null)
				{
					if(storedDATA != null)
					{
						int EntityID = storedDATA.getInteger("EntityID");
						Entity entityToSpawn = null;
						
						switch(EntityID)
						{
						case 0:
							entityToSpawn = new EntityAutomatonsRook(this.worldObj);
							break;
						case 1:
							entityToSpawn = new EntityWitePawns(this.worldObj);
							break;
						}
						
						this.worldObj.spawnEntityInWorld(entityToSpawn);
						
						this.worldObj.setBlockToAir(this.getPos());
						this.worldObj.removeTileEntity(this.getPos());
					}
				}
		}else
			this.checkPlayerCD--;
	}	
}
